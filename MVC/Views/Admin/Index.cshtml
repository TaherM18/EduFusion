@{
    ViewData["Title"] = "Dashboard";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="container">
    <div id="chartsContainer"></div> <!-- Container for multiple charts -->
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            const apiUrl = "http://localhost:5190/api/subject-tracking"; // API

            // Fetch API Data
            $.ajax({
                url: apiUrl,
                method: "GET",
                dataType: "json",
                success: function (response) {
                    generateCharts(response);
                },
                error: function (error) {
                    console.error("API Error:", error);
                }
            });

            function generateCharts(data) {
                let groupedData = {};

                // Group data by standard
                data.forEach(item => {
                    let standardID = item.subject.standard.standardID;
                    let standardName = item.subject.standard.standardName;
                    let subjectName = item.subject.subjectName;
                    let percentage = item.percentage;

                    if (!groupedData[standardID]) {
                        groupedData[standardID] = {
                            standardName: standardName,
                            subjects: []
                        };
                    }
                    groupedData[standardID].subjects.push({ subjectName, percentage });
                });

                // Clear container before rendering
                $("#chartsContainer").empty();

                // Generate separate charts for each standard
                Object.keys(groupedData).forEach(standardID => {
                    let standardData = groupedData[standardID];

                    // Create a chart container dynamically
                    let chartDivId = `chart-${standardID}`;
                    $("#chartsContainer").append(`<div id="${chartDivId}" style="height: 400px; margin-bottom: 20px;"></div>`);

                    // Render Kendo Chart
                    $(`#${chartDivId}`).kendoChart({
                        title: { text: `Syllabus Coverage Of ${standardData.standardName} Standard` },
                        legend: { position: "top" },
                        seriesDefaults: { type: "bar" },
                        series: [{
                            name: "Percentage",
                            data: standardData.subjects.map(s => s.percentage)
                        }],
                        categoryAxis: {
                            categories: standardData.subjects.map(s => s.subjectName),
                            title: { text: "Subjects" }
                        },
                        valueAxis: {
                            title: { text: "Percentage" },
                            min: 0, max: 100
                        },
                        tooltip: {
                            visible: true,
                            format: "{0}%"
                        }
                    });
                });
            }
        });
    </script>
}